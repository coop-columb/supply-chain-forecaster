#!/bin/bash
# Generate a mock Kubernetes config file for CD testing

# Create the mock kubeconfig file
cat > mock_kubeconfig.yaml << EOF
apiVersion: v1
kind: Config
clusters:
- name: test-cluster
  cluster:
    server: https://api.test-cluster.example.com:6443
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJME1ETXlOREF3TURBeE1Gb1hEVE0wTURNeU1UQXdNREF4TUZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTU9VCmUrUjdHaUNJb2VlL0lCbjJWdTl4QzlreFR5ZGJCQ0ZWbG1PazRjL0U4Vy91MDRnZHJDRjdVWlRzbkgxUmNybHUKKzFIMkh5TWIyWmNLWnBuRmdvQWc4bHl6QWV2QVhIVjUzNllpYklYbytQK1JRNzVGSlBxeWJWQy9IQ3BHaHdsYgo4V2hFVVVyTzJWbFZ0K21wVHRTVmRVQWRSUWRhMnlTeUQ2NWJlWVF6UlY0L3VnYk9IUnhTeVNISW9RNWI5UkRnCmJsRjB1cnRxcWw1ZnJEOTlaeW5HRTFtVnVXNTNpYnBxaDh5aW5Ldk96YWNNanpHWXVpVmUxN0o1UmlHSlFYVncKL0l5VFJZMGxva3hHbE12eDBEb1djcjY4V3g2MitMcW5XSEVlTXQ1dmFxR256d3NLUFhKT0tpU1p1MWZMN3JLawpwUTdxbDVDVVJuc1lFR3NDQXdFQUFhTWpNQ0V3RGdZRFZSMFBBUUgvQkFRREFnS2tNQThHQTFVZEV3RUIvd1FGCk1BTUJBZjh3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUNYcjZVMmtyY3RoZEZYTDFhU1NzWlFhbExLOVU3ekIKVGw3YkNzODRmU0NYbmgwVTJ3ejdGVzJsTFdBb3o5eUdVeDJFVVc3SWk0c3VIcDBzR0s5eXVvQ25lczlYRmplcApzVkZEcXlra0U1VVdXMDkyTTZZZGJBdkd6YzFMeEkrV3RXVUxsM0VpNVY4NEY3em12cGw1R3lqd0R0V3VZckdiCm11MkdZcytabzU3ZWZUVitlUmg0THlCTkxPV0xsNFVqYzVnYzVyV013dVE0Z0pWQlJtV3ZsVjE3THdDL0NmQnYKdTZ1N2QzMDFEZ0FLWkhrNFdLYnZLZUV2R3RVU3RVRkRlVjdGUkM5NndHMmZMOFJMODU0Sk56cGZOc3lUZktJRApSTm5wYmh2ZTBWYzVPOVJVNXNsQkhFZi80bzJUTWVuRXRxazBKWEdKV3BjVjhnSlczQkU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
contexts:
- name: test-context
  context:
    cluster: test-cluster
    user: test-user
current-context: test-context
users:
- name: test-user
  user:
    token: eyJhbGciOiJSUzI1NiIsImtpZCI6ImRCZV9RZEdJeS1RMDlYUURfQ1lHc2REdGxCbTl3STZ5N3JNNlNmNkE0aDAifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRlZmF1bHQtdG9rZW4tc3Y0dmsiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVmYXVsdCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImRhNDNkODY5LWI3MGMtNDZlMS1iNzU5LTBiZjlkMGU5MTczMSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.CdK0kKgh9zXmYB-jSD6eGJx6WT3ODcYvOCUOBQYkP1YbULBFJH7hqVYQHXUj4mgmCJRKGlyhFy1Qdqm_4J-UoQ
EOF

# Base64 encode the file for GitHub Environments
cat mock_kubeconfig.yaml | base64 > mock_kubeconfig_base64.txt

echo "Mock kubeconfig created successfully."
echo ""
echo "Use the content of mock_kubeconfig_base64.txt for both KUBE_CONFIG_STAGING and KUBE_CONFIG_PRODUCTION secrets in GitHub Environments."